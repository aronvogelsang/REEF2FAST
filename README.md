# REEF2FAST

**Version:** 3.0  
**Developer:** Aron Vogelsang  
**License:** GNU GPL v3.0  
**Repository:** https://github.com/aronvogelsang/REEF2FAST  

## Overview

REEF2FAST is a command-line coupling pre-processing toolchain to utilize wavefields generated by the shock-capturing non-hydrostatic Navier-Stokes solver REEF3D::NNHFLOW in the multiphysics tool OpenFAST. 

NHFLOW offers a favorable balance between computational efficiency and physical accuracy, sufficiently resolving the vertical distribution of flow structures, unlike shallow-water equation or Boussinesq-type models. Moreover, it provides an intrinsic pressure field, in contrast to potential flow solvers, while avoiding the high computational costs of full CFD models. Consequently, the coupling between NHFLOW and OpenFAST allows the use of high-fidelity wavefields in OpenFAST while preserving OpenFAST's efficiency for lightweight simulations.

REEF2FAST is fully OpenSource and written in C++. Its architecture is build around a memory efficient streaming pipeline, is paralellized with OpenMP, and contains efficient sort and interpolation algorithms like a kd-tree/inverse weighting strategy.
Physical constistency is proven in various validation cases. If you are interested in using the tool, want more information, or have ideas to extend its usecases, you can write me a message or use the forum.

---

## Installation

### Prerequisites

- C++17 compatible compiler (e.g., `g++`, `clang++`)
- OpenMP support (for parallel processing)
- CMake (version ≥ 3.10)
- Make
- Git

### Build Instructions

```bash
git clone https://github.com/aronvogelsang/REEF2FAST.git
cd REEF2FAST
mkdir build && cd build
cmake ..
make
```

The executable `reef2fast` will be created in the `build/` directory.  
**Run the program from there.**

---

## Usage

### Preparation

Create direcetory named `data` inside the REEF2FAST main directory before running!!!

Ensure the following input files are placed in the `data/` directory:

1. `control.txt` – DiveMESH grid & domain configuration  
2. `ctrl.txt` – REEF3D simulation settings (Hs, Tp, duration, timestep)  
3. `XXX.csv` – Extracted REEF3D wavefield file (exported from ParaView)

> **CSV Format Note:**  
> The REEF3D CSV file must contain a header in the following format:  
> `timestep,u,v,w,eta,pressure,x,y,z`  
> Make sure to Tick in ParaView: "Write Time Steps" and  "Add Time Step"

### Run

```bash
./reef2fast
```

The program will:

1. Parse control parameters
2. Interpolate REEF3D wavefield data onto the OpenFAST SeaState grid
3. Compute velocity, acceleration, and surface elevation
4. Export OpenFAST-compatible `.Vi`, `.Ai`, `.DynP`, `.Elev` files
5. Optionally write a CSV file (`interpolated_wavefield.csv`) for diagnostics

---

## Output Files

All output files will be placed in the `output/` (will be created in runtime) directory:

- `REEF2FAST.Vxi`, `.Vyi`, `.Vzi` – velocity components  
- `REEF2FAST.Axi`, `.Ayi`, `.Azi` – acceleration components  
- `REEF2FAST.DynP` – dynamic pressure  
- `REEF2FAST.Elev` – surface elevation  
- `interpolated_wavefield.csv` – optional timestep-wise diagnostics  
- `REEF2FAST.dat` – SeaState grid configuration file for OpenFAST

---

## Compatibility

- **OpenFAST:** v4.0.2 (tested)  
- **REEF3D:** v25.02 (tested)  
- **Supported Solver:** REEF3D::NHFLOW  
  *(Other solvers may work if the CSV header matches the required format: `"TimeStep","velocity:0","velocity:1","velocity:2","pressure","elevation","Points:0","Points:1","Points:2"`)*

---

## More Information

- For a detailed description of REEF3D and its implemented modules, including the module NHFLOW used in this project, visit the [REEF3D website](https://www.reef3d.com/).  
  The source code is available at [REEF3D GitHub](https://github.com/REEF3D).
- For a detailed description of OpenFAST, visit the [OpenFAST website](https://openfast.readthedocs.io/en/main/index.html).  
  The source code is available at [OpenFAST GitHub](https://github.com/OpenFAST).  
  Additionally, a short OpenFAST user guide, specifically written for the REEF2FAST context, is available in the `user_guides/` folder.
- A comprehensive overview of the theories and methodologies applied in REEF2FAST is provided in my thesis.  
  Furthermore, a dedicated REEF2FAST user guide is available in the `user_guides/` folder. 
  Information about the validation and verification cases can be found in the `benchmark/` folder.

---
